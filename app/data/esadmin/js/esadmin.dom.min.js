var EsAdmin={Tool:{_addCls:function(i,n,t){n=n||"active",i.addClass(n);var a=t?i.siblings(t):i.siblings();a.removeClass(n)},_ajaxStart:function(){return $(document).ajaxStart(function(){EsAdmin.Tool._addCls($("#loadding"),"active",".fix")}),this},_ajaxComplete:function(){return $(document).ajaxComplete(function(){$("#loadding").removeClass("active")}),this},_ajaxError:function(){return $(document).ajaxError(function(){$("#loadding").removeClass("active")}),this},_height:function(i){return i=i||window,$(i).height()},_resultOk:function(i){this._result("ok","checkmark",i||"成功！")},_resultErr:function(i){this._result("err","close",i||"失败！")},_result:function(i,n,t){$m=$('<p class="result-'+i+'"><i class="ion-'+n+'-circled"></i>'+t+"</p>"),$m.appendTo("#tabs .tab.active").delay(2e3).fadeOut(2e3)},_scrollTop:function(){return $("body,html").animate({scrollTop:0},300),!1}},Dom:{_init:function(){this.Tab._init(),this.Nav._init(),this.Body._init(),this.A._init()},A:{_init:function(){$("#panels").on("click","a:not(.no-bind-a)",EsAdmin.Dom.A._click),$("#panels").on("click",".reback,.refresh",function(){var i=EsAdmin.Dom.Body._tabPanel();$(this).hasClass("reback")?EsAdmin.Dom.History._back(i[0].data("fromid"),i[1]):EsAdmin.Dom.History._refresh(i[0].data("fromid"),i[1])})},_click:function(){var i=EsAdmin.Dom.Body._tabPanel(),n=$(this).data("href");EsAdmin.Dom.Load._panel(i[1],n,1)}},Body:{homeUrl:"/esadmin/home/welcome",_init:function(){$("#top-container").css("height",EsAdmin.Tool._height()),EsAdmin.Dom.Load._hook(),this._show()},_show:function(){$("body").addClass("active"),$("#loadding").removeClass("active")},_hide:function(){$("body").removeClass("active"),$("#loadding").addClass("active")},_tabPanel:function(){return[$("#tabs .tab.active"),EsAdmin.Dom.Panel._active()]},_refresh:function(){EsAdmin.Dom.Panel._find("button.refresh.btn-smallx2").trigger("click")}},History:{tab:[],_add:function(i,n){this.tab[i]=this.tab[i]||[];var t=1;$.each(this.tab[i],function(i,a){return a==n?(t=0,!1):void 0}),t&&this.tab[i].push(n)},_back:function(i,n){this.tab[i].pop();var t=this.tab[i];EsAdmin.Dom.Load._panel(n,t[t.length-1],t.length>1)},_refresh:function(i,n){var t=this.tab[i];EsAdmin.Dom.Load._panel(n,t[t.length-1],t.length>1)}},Load:{_err:function(i){return i=i||"Error,请求失败。",'<p class="err"><i class="ion-alert-circled"></i>'+i+"</p>"},_panel:function(i,n,t,a,e,s){e=e||"",s=s||"",t="<p>"+(t?'<button type="button" class="reback btn-smallx2 btn-green">后退</button>':"")+'<button type="button" class="refresh btn-smallx2 btn-orange">刷新</button></p>',a=a||$("#tabs .tab.active").data("fromid"),EsAdmin.Dom.History._add(a,n),i.load(n,function(i,a){"error"==a?$(this).html(EsAdmin.Dom.Load._err(n)):($(this).html(t+e+i+s),EsAdmin.Tool._addCls($(this)),EsAdmin.Dom.Load._hook())})},_hook:function(){EsAdmin.Dom.Panel._find(".es4-form").length&&("undefined"==typeof Form?$.getScript("/min/esadmin-esadmin.form.min.js",function(){Form._init()}):Form._init()),EsAdmin.Dom.Panel._find(".eno-datagrid").length&&("undefined"==typeof Grid?$.getScript("/min/esadmin-esadmin.grid.min.js",function(){Grid._init()}):Grid._init());var i=EsAdmin.Dom.Panel._find(".load-script");if(i.length){var n=i.data("src");n.length&&$.getScript(n)}}},Nav:{len:9,_init:function(){$("#nav span").each(function(){EsAdmin.Dom.Nav._isHide($(this))}).click(function(){$(this).next("div").toggle(),EsAdmin.Dom.Nav._isHide($(this))}),$("#nav a").click(EsAdmin.Dom.Nav._a)},_isHide:function(i){i.children("em").toggleClass("active",!i.next("div").is(":hidden"))},_a_active:function(i){$("#nav a").removeClass("active"),i.addClass("active")},_a:function(){if($t=$(this),EsAdmin.Dom.Nav._a_active($t),!$("#loadding").is(":hidden"))return!1;var i=$t.attr("id"),n=$('#tabs [data-fromid="'+i+'"]');if(n.length)EsAdmin.Dom.Tab._switch(n);else{$("#tabs .tab").length==EsAdmin.Dom.Nav.len&&$("#tabs .tab:not(.active)").eq(1).find("i").trigger("click");var t=$t.clone();t.find("i,sup").remove();var a=t.html(),e=$t.data("href"),s=$('<div class="tab" data-fromid="'+i+'">'+a+"</div>"),o=$('<div class="panel"></div>');s.append($('<i class="ion-ios-close-outline"></i>')),EsAdmin.Dom.Load._panel(o,e,0,i),$("#tabs").append(s),$("#panels").append(o),s.trigger("click")}return EsAdmin.Tool._scrollTop(),!1}},Tab:{_init:function(){$("#tabs").on("click",".tab",EsAdmin.Dom.Tab._switch).on("click","i",EsAdmin.Dom.Tab._close)},_close:function(){return i=$(this).parent(".tab").index(),$("#tabs .tab").eq(i).remove(),EsAdmin.Dom.Panel._list().eq(i).remove(),$("#tabs .tab.active").length||$("#tabs .tab:last-child").trigger("click"),!1},_switch:function(i){var n=i instanceof jQuery?i.index():$(this).index(),t=i instanceof jQuery?i:$(this),a=$("#"+t.data("fromid"));EsAdmin.Tool._addCls(t),EsAdmin.Tool._addCls(EsAdmin.Dom.Panel._list().eq(n)),EsAdmin.Dom.Nav._a_active(a)}},Panel:{_active:function(i){var n=$("#panels .panel.active");return i?n.find(i):n},_list:function(i){var n=$("#panels .panel");return i?n.eq(i):n},_find:function(i){return EsAdmin.Dom.Panel._active(i)}}},Search:{_init:function(){$("#es-search span").click(EsAdmin.Search._submit),$("#es-search input").keypress(function(i){"13"==i.keyCode&&EsAdmin.Search._submit()})},_submit:function(){var i=$("#es-search input").val(),n=$("#nav a.active"),t=n.data("href"),a=n.children("sup").length;i&&t&&a&&EsAdmin.Dom.Load._panel(EsAdmin.Dom.Panel._active(),t+"?search-key="+i,1)}}};EsAdmin.Tool._ajaxStart()._ajaxComplete()._ajaxError(),EsAdmin.Dom._init(),EsAdmin.Search._init();
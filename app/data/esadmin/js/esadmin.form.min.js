var Form={_init:function(){this._select()._button()._textarea()._fileUpload()},_fileUpload:function(){var t=$("#panels .panel.active .uploader");return t.length&&($.getScript("/theme/dmuploader/src/dmuploader.min.js",function(){t.each(function(){Form.Upload._init($(this),$(this).data("action"),$(this).find('input[type="file"]').attr("name"))})}),t.each(function(){var t=$(this).find('input[type="hidden"]').val();t.length&&Form.Upload._preview($(this),t)})),this},_textarea:function(){return $textarea=$("#panels .panel.active textarea"),$textarea.length&&$textarea.each(function(t){var n=$(this).attr("id");n&&($("#"+n).css({width:920}),UE.delEditor(n),UE.getEditor(n))}),this},_button:function(){return $("#panels .panel.active .es4-form button:not(.fileUpload)").click(function(){Form.Button._click($(this))}),this},_select:function(){$(".select-js").on("change","select",function(){Form.Select._change($(this))});var t=$("#panels .panel.active select[data-pids]");return t.length&&t.each(function(){var t=$(this).data("pids").toString(),n=$(this).parent(".select-js"),i=$(this).data("name");Form.Select._init(n,t,i)}),this},Button:{_click:function(t){var n=t.parents("form"),i=n.attr("action");$.post(i,n.serialize(),function(t){if(Number(t.err))EsAdmin.Tool._resultErr();else{var e=(i+t.id+"/").replace(t.id+"/"+t.id,t.id);n.attr("action",e),EsAdmin.Tool._resultOk()}},"json")}},Select:{container:"",name:"",ids:[],_init:function(t,n,i){this.container=t,this.name=i;var e=t.find("select");n.length>0&&(this.ids=n.split("-")).length>=1?(e.remove(),this._new(0)):(e.find('option[value="0"]').length||e.prepend('<option value="0" selected>请选择</option>'),e.attr("name",i+"[]"),Form.Select._auto(e))},_change:function(t){var n=t.attr("name").replace("[]","");if($.inArray(n,["category_id","area_ids","category_pid","goods_category_id"])<0)return!1;Form.Select.container=Form.Select.container||t.parent(".select-js"),Form.Select.name=Form.Select.name||t.data("name"),t.nextAll("select").remove();var i=t.val();i>0&&$.get("/esadmin/category/catsbypid/"+t.val(),function(t){if(!Number(t.err)&&t.msg.toString().length){var n=Form.Select._sel();$.each(t.msg,function(t,e){n.append('<option value="'+t+'"'+(t==i?" selected":"")+">"+e+"</option>")}),Form.Select.container.append(n)}},"json")},_new:function(t){if(t>=this.ids.length)return!1;var n=this.ids[t];sid=t+1<this.ids.length?this.ids[t+1]:-1,$.get("/esadmin/category/catsbypid/"+n,function(n){if(!Number(n.err)&&n.msg.toString().length){var i=Form.Select._sel();$.each(n.msg,function(t,n){i.append('<option value="'+t+'"'+(t==sid?" selected":"")+">"+n+"</option>")}),Form.Select.container.append(i)}Form.Select._new(++t)},"json")},_sel:function(){return $('<select name="'+Form.Select.name+'[]"><option value="0">请选择</option></select>')},_auto:function(t){var n=t.parents("form").data("selectauto");(void 0===n||1===n)&&t.trigger("change")}},Upload:{_init:function(t,n,i){t.dmUploader({url:n,fileName:i,dataType:"json",allowedTypes:"*",extFilter:"jpg;png;gif;mp4",onUploadSuccess:function(n,e){var a=e[i][0].url;t.find('input[name="'+i+'-tmp"]').val(a),Form.Upload._preview(t,a)},onUploadError:function(t,n){console.log("上传失败")}})},_preview:function(t,n){var i=n.indexOf(".mp4")>0,e=i?'<video src="'+n+'" height="65" autoplay controls="controls"></video>':'<img src="'+n+'" alt="">';t.next(".preview").html(e)}}};